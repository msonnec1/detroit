<!DOCTYPE html>
<html>
<head>
	<title>chat</title>
	<style type="text/css">
	</style>
	<script src="jquery-1.6.2.min.js"></script>	
	<script type="text/javascript">

	function Chat() {
		var SERVER = "http://10.0.2.3:8080/";
		var ROOM = "lelijkvliegtuig";

		function start() {
			setInterval(poll, 2000);
		}
		
		function poll() {
			send({"dude": "taco", "chat": "test"+10000*Math.round(Math.random()}));
		}	

		function receive(data) {
			console.info("received", data);
			/*data.messages.forEach(function(msg) {
				lastMsg = msg.id;
				lastMsgTime = msg.timeStamp;
				if(msg.data.u && msg.data.u.length == 6) { // ignore Anne's test rommel
					var uid = msg.data.u;
				}
			});*/
		}

		function send(data) {
			if(sending) {
				console.info("still sending, skipping");
				return;
			}
			sending = true;
			
			var url = SERVER + "?since=" + lastMsg + "&j=" + encodeURIComponent(JSON.stringify(data));

			$.ajax(url, {
				type: "GET", async: true,
				error: function() { console.warn("Failed to send"); sending = false; },
				success: function(data, status, xhr) {
					sending = false;
					receive(data);
				},
				complete: function() { sending = false; }
			});
		}
	}

	$(function() {
		var chatroom = Chat();
		chatroom.start();		
	});

	</script>
</head>
<body>
	<div id="command">
		<input type="text" id="chat"></input>
		<button id="send">chat</button>
	</div>
	<div id="messages">
	</div>
</body>
</html>